<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Find the Button</title>
<style>
  :root{
    --bg1:#232526; --bg2:#414345;
    --popup-bg:#222; --drag-bg:linear-gradient(90deg,#373737,#292929 80%);
    --accent:#ff5252;
  }
  html,body{height:100%;margin:0;background:linear-gradient(135deg,var(--bg1),var(--bg2));font-family: "Segoe UI", Arial, sans-serif;overflow:hidden}
  #game-shell{display:flex;align-items:center;justify-content:center;height:100vh}
  #panel{width:820px;max-width:95vw;background:#1e1e1e;border-radius:18px;padding:26px;box-shadow:0 12px 40px rgba(0,0,0,.6);color:#fff;position:relative}
  h1{margin:0 0 12px;font-size:22px}
  p{margin:6px 0 18px;color:#d1c4e9}
  #start{background:var(--accent);border:none;padding:10px 18px;border-radius:10px;color:#fff;font-weight:700;cursor:pointer}
  #info{margin-top:12px;color:#ffd54f}

  /* popup style derived from your file */
  .popup{
    position:fixed;
    z-index:999;
    background:var(--popup-bg);
    border-radius:14px;
    box-shadow:0 8px 32px rgba(0,0,0,.7);
    min-width:280px;
    min-height:72px;
    padding:0;
    border:3px solid #444;
    user-select:none;
    transition:box-shadow .12s, transform .08s;
  }
  .drag{
    height:30px;padding:6px 12px;display:flex;align-items:center;color:#fff;font-weight:600;border-top-left-radius:10px;border-top-right-radius:10px;background:var(--drag-bg);cursor:move;
  }
  .close{
    position:absolute;right:8px;top:6px;font-size:18px;color:#ccc;background:transparent;border:0;border-radius:50%;padding:4px;cursor:pointer;
  }
  .close:hover{background:#ff2121;color:#fff}
  .popup-body{padding:10px 12px;margin-top:8px;display:flex;align-items:center;justify-content:center;height:44px}

  /* hidden target button: blends into popup but is clickable */
  .target{
    padding:6px 10px;border-radius:8px;border:1px solid rgba(255,255,255,.06);
    background:linear-gradient(180deg,#2a2a2a,#242424);
    color:rgba(255,255,255,.06); /* near invisible text color */
    font-weight:700;cursor:pointer;outline:none;
    transition:all .18s;
    box-shadow:0 2px 8px rgba(0,0,0,.2);
  }
  .target:focus{box-shadow:0 0 0 3px rgba(255,82,82,.12)}

  /* when revealed on gameover, highlight it */
  .reveal {
    color: #fff !important;
    background: linear-gradient(90deg,#fff2,#ffecb3);
    transform:scale(1.08);
    animation: pulseFade 1.2s ease-in-out infinite;
    border:2px solid #ffd54f !important;
  }
  @keyframes pulseFade {
    0%{box-shadow:0 0 0 0 rgba(255,213,79,.14)}
    70%{box-shadow:0 0 30px 12px rgba(255,213,79,0)}
    100%{box-shadow:0 0 0 0 rgba(255,213,79,0)}
  }

  /* overlay & messages */
  #overlay{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;z-index:2000}
  #overlay .box{background:#111;padding:22px;border-radius:12px;text-align:center;color:#fff;min-width:280px;box-shadow:0 12px 40px rgba(0,0,0,.6)}
  #overlay h2{margin:0 0 8px;font-size:20px}
  #overlay button{margin-top:12px;padding:8px 12px;border-radius:8px;border:none;background:var(--accent);color:#fff;cursor:pointer}

  /* small helper */
  #timer{font-weight:700;color:#90caf9;margin-left:8px}
  @media (max-width:520px){
    .popup{min-width:76vw}
  }
</style>
</head>
<body>
  <div id="banners"></div>

  <div id="game-shell">
    <div id="panel">
      <h1>Find the Button</h1>
      <p>30 identical popups will appear. One of them hides the button. Find it within <strong>15 seconds</strong>. If you fail, the game will reveal where it was (no mercy).</p>
      <button id="start">Start Game</button>
      <div id="info">Time left: <span id="timer">--</span></div>
    </div>
  </div>

  <!-- overlay shown on win/lose -->
  <div id="overlay">
    <div class="box">
      <h2 id="overlay-title">...</h2>
      <div id="overlay-msg"></div>
      <button id="restart" onclick="location.reload()">Reload to play again</button>
    </div>
  </div>

<script>
/* --- Configuration --- */
const TOTAL_POPUPS = 30;
const TIME_LIMIT = 15 * 1000; // ms

/* --- helpers --- */
function randInt(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }
function clamp(n,a,b){ return Math.max(a, Math.min(b,b)); }

/* --- create popups --- */
const bannersRoot = document.getElementById('banners');
let popups = [];
let targetIndex = null;
let gameTimer = null;
let startTimestamp = null;
let found = false;
const timerEl = document.getElementById('timer');
const overlay = document.getElementById('overlay');
const overlayTitle = document.getElementById('overlay-title');
const overlayMsg = document.getElementById('overlay-msg');

function createPopup(i, withTarget){
  const pad = 12;
  const popup = document.createElement('div');
  popup.className = 'popup';
  popup.style.left = randInt(pad, window.innerWidth - 320 - pad) + 'px';
  popup.style.top  = randInt(pad, window.innerHeight - 110 - pad) + 'px';
  popup.style.width = '320px';
  popup.style.height = '90px';
  popup.dataset.index = i;

  // drag area
  const drag = document.createElement('div');
  drag.className = 'drag';
  drag.textContent = 'Special Offer — Drag Me!';
  popup.appendChild(drag);

  // close button
  const close = document.createElement('button');
  close.className = 'close';
  close.innerHTML = '&times;';
  close.title = 'Close';
  close.addEventListener('click', (e)=>{
    e.stopPropagation();
    popup.remove();
  });
  popup.appendChild(close);

  // body
  const body = document.createElement('div');
  body.className = 'popup-body';

  if(withTarget){
    // the hidden button: blends into popup (very low contrast)
    const target = document.createElement('button');
    target.className = 'target';
    target.textContent = 'Click Me';
    // purposely low-contrast; player must inspect carefully
    target.addEventListener('click', (e)=>{
      e.stopPropagation();
      onFound(popup, target);
    });
    body.appendChild(target);
    // store ref for reveal later
    popup._targetEl = target;
  } else {
    // filler content
    const txt = document.createElement('div');
    txt.style.color = '#cfcfcf';
    txt.style.fontSize = '13px';
    txt.textContent = 'Ad: Upgrade now for extra powerups!';
    body.appendChild(txt);
  }

  popup.appendChild(body);

  // Dragging
  let dragging=false, offsetX=0, offsetY=0;
  function startDrag(e){
    dragging=true;
    const rect = popup.getBoundingClientRect();
    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
    const clientY = e.touches ? e.touches[0].clientY : e.clientY;
    offsetX = clientX - rect.left;
    offsetY = clientY - rect.top;
    document.body.style.userSelect = 'none';
  }
  function moveDrag(e){
    if(!dragging) return;
    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
    const clientY = e.touches ? e.touches[0].clientY : e.clientY;
    const left = clamp(clientX - offsetX, pad, window.innerWidth - popup.offsetWidth - pad);
    const top  = clamp(clientY - offsetY, pad, window.innerHeight - popup.offsetHeight - pad);
    popup.style.left = left + 'px';
    popup.style.top  = top  + 'px';
  }
  function stopDrag(){ dragging=false; document.body.style.userSelect=''; }

  drag.addEventListener('mousedown', startDrag);
  document.addEventListener('mousemove', moveDrag);
  document.addEventListener('mouseup', stopDrag);

  drag.addEventListener('touchstart', startDrag, {passive:false});
  document.addEventListener('touchmove', moveDrag, {passive:false});
  document.addEventListener('touchend', stopDrag);

  bannersRoot.appendChild(popup);
  popups.push(popup);
}

/* --- game control --- */
function startGame(){
  // clear any previous
  popups.forEach(p=>p.remove());
  popups = [];
  found = false;
  overlay.style.display = 'none';
  timerEl.textContent = (TIME_LIMIT/1000) + 's';

  // pick target index
  targetIndex = randInt(0, TOTAL_POPUPS - 1);

  for(let i=0;i<TOTAL_POPUPS;i++){
    createPopup(i, i===targetIndex);
  }

  // start countdown
  startTimestamp = Date.now();
  updateTimer();
  gameTimer = setInterval(updateTimer, 100);
}

function updateTimer(){
  const elapsed = Date.now() - startTimestamp;
  const remaining = Math.max(0, TIME_LIMIT - elapsed);
  timerEl.textContent = (Math.ceil(remaining/1000)) + 's';
  if(remaining <= 0){
    clearInterval(gameTimer);
    if(!found) revealAndLose();
  }
}

function onFound(popup, targetEl){
  if(found) return;
  found = true;
  clearInterval(gameTimer);
  // subtle celebration
  targetEl.classList.add('reveal');
  overlayTitle.textContent = 'You found it!';
  overlayMsg.innerHTML = `Nice detective work. You clicked the hidden button inside popup #${popup.dataset.index}.<br>Your time: ${(Date.now()-startTimestamp)/1000}s`;
  overlay.style.display = 'flex';
}

function revealAndLose(){
  // reveal: highlight target element with fade-in effect
  const targetPopup = popups.find(p => p.dataset.index==targetIndex);
  if(!targetPopup){
    // popup might have been closed; create a marker
    overlayTitle.textContent = 'Game Over';
    overlayMsg.textContent = 'The popup containing the button was closed. Try again.';
    overlay.style.display = 'flex';
    return;
  }
  const t = targetPopup._targetEl;
  if(t){
    // make it clearly visible and animate
    t.classList.add('reveal');
    // optionally, bring it to front & scroll it into view
    targetPopup.style.zIndex = 99999;
    targetPopup.style.transform = 'scale(1.02)';
    // flash overlay message
    overlayTitle.textContent = 'Time\'s up — Game Over';
    overlayMsg.innerHTML = 'The hidden button is revealed. Reload to try again.';
    overlay.style.display = 'flex';
    // small animation to draw attention (fade-in is through reveal styles)
    t.style.transition = 'opacity .8s ease, transform .3s ease';
    t.style.opacity = 1;
  } else {
    overlayTitle.textContent = 'Game Over';
    overlayMsg.textContent = 'Button not found (it was removed).';
    overlay.style.display = 'flex';
  }
}

/* --- wire start button --- */
document.getElementById('start').addEventListener('click', ()=>{
  startGame();
});

/* --- keep layout responsive on resize: reposition popups slightly so they don't go off-screen --- */
window.addEventListener('resize', ()=>{
  popups.forEach(p=>{
    const pad = 12;
    const maxLeft = Math.max(pad, window.innerWidth - p.offsetWidth - pad);
    const maxTop  = Math.max(pad, window.innerHeight - p.offsetHeight - pad);
    const left = parseInt(p.style.left) || 0;
    const top  = parseInt(p.style.top) || 0;
    p.style.left = Math.min(left, maxLeft) + 'px';
    p.style.top  = Math.min(top, maxTop) + 'px';
  });
});
</script>
</body>
</html>

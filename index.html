<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Whack-a-Mole - Fun Mini Game</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
    :root {
        --bg:#10151c;
        --panel:#182330;
        --accent:#24d26f;
        --accent-glow:#24d26faa;
        --danger:#ff4d4d;
        --text:#e9f1f8;
        --muted:#8aa0b5;
        --gold:#ffcf40;
        font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,sans-serif;
    }
    * { box-sizing: border-box; }
    body {
        margin:0;
        background: radial-gradient(circle at 30% 20%, #203040, #0c1116);
        color: var(--text);
        display:flex;
        min-height:100dvh;
        align-items:center;
        justify-content:center;
        padding: clamp(10px,3vw,40px);
    }
    h1 {
        margin:0 0 .35em;
        font-size: clamp(1.9rem,4vw,3rem);
        letter-spacing:.03em;
        background: linear-gradient(90deg,var(--accent),#27b3ff,#9b5bff);
        -webkit-background-clip:text;
        color:transparent;
    }
    .game-shell {
        width: min(900px,100%);
        background: linear-gradient(160deg,#1d2834,#111a24 60%);
        border: 2px solid #243647;
        border-radius: 22px;
        padding: clamp(16px,2.2vw,34px);
        box-shadow: 0 10px 40px -10px #000, 0 0 0 1px #243647 inset;
        position:relative;
        overflow:hidden;
    }
    .top-bar {
        display:flex;
        flex-wrap:wrap;
        gap:12px;
        align-items:center;
        justify-content:space-between;
        margin-bottom:12px;
    }
    .stats {
        display:flex;
        flex-wrap:wrap;
        gap:14px;
        font-size: clamp(.85rem,1.6vw,1rem);
    }
    .stat {
        background: var(--panel);
        padding:6px 14px;
        border-radius: 999px;
        display:flex;
        align-items:center;
        gap:6px;
        box-shadow: 0 0 0 1px #22313f, 0 4px 10px -6px #000;
    }
    .stat span.value {
        font-weight:600;
        color: var(--accent);
        text-shadow: 0 0 6px var(--accent-glow);
        min-width:2ch;
        text-align:right;
    }
    button {
        cursor:pointer;
        background: linear-gradient(120deg,var(--accent) 0%,#2fe88a 70%);
        color:#062414;
        font-weight:600;
        font-size: clamp(.9rem,1.6vw,1.05rem);
        border:none;
        padding:12px 26px;
        border-radius: 14px;
        letter-spacing:.04em;
        box-shadow: 0 4px 14px -4px var(--accent-glow),0 0 0 1px #1b3c2a inset;
        transition:.18s cubic-bezier(.4,.8,.4,1);
        position:relative;
        overflow:hidden;
    }
    button:disabled {
        filter:grayscale(.7);
        opacity:.55;
        cursor:not-allowed;
    }
    button:not(:disabled):hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 22px -8px var(--accent-glow),0 0 0 1px #1b3c2a inset;
    }
    button:active { transform:translateY(0); }
    .board {
        --cols:3;
        aspect-ratio: 1 / 1;
        display:grid;
        grid-template-columns:repeat(var(--cols),1fr);
        gap: clamp(10px,1.8vw,22px);
        margin: 20px auto 10px;
        width: min(520px,100%);
        position:relative;
        user-select:none;
    }
    .hole {
        position:relative;
        background: linear-gradient(#263745,#17222c);
        border-radius: 20px;
        box-shadow:
            0 8px 18px -8px #000,
            0 0 0 2px #223240,
            0 0 22px -6px #1a2a36 inset,
            0 4px 10px -6px #000 inset;
        overflow:hidden;
        cursor:pointer;
        isolation:isolate;
    }
    .hole::after {
        content:"";
        position:absolute;
        inset:0;
        background:
            radial-gradient(circle at 30% 25%,rgba(255,255,255,.12),transparent 60%),
            radial-gradient(circle at 70% 75%,rgba(255,255,255,.05),transparent 70%);
        opacity:.5;
        mix-blend-mode:overlay;
        pointer-events:none;
    }
    .mole {
        position:absolute;
        left:50%;
        bottom:-120px;
        width:70%;
        aspect-ratio: 1/1;
        transform:translateX(-50%);
        background: radial-gradient(circle at 30% 25%,#ffe7c9,#e2a976 55%,#b76a38 90%);
        border-radius: 45% 45% 40% 40% / 55% 55% 35% 35%;
        box-shadow: 0 10px 25px -8px #000, 0 0 0 3px #51361f inset;
        display:flex;
        align-items:center;
        justify-content:center;
        font-size: clamp(1.5rem,2.4vw,2.2rem);
        text-shadow: 0 2px 3px #0008;
        filter:drop-shadow(0 5px 6px #000a);
        transition: bottom .28s cubic-bezier(.65,1.8,.45,.9);
        font-weight:700;
        color:#41220d;
        letter-spacing:.02em;
        line-height:1;
    }
    .mole.good { background: radial-gradient(circle at 30% 25%,#eafff7,#68ffd1 55%,#00b980 95%); box-shadow: 0 10px 25px -8px #000, 0 0 0 3px #007751 inset; color:#003d28; }
    .mole.bad  { background: radial-gradient(circle at 40% 30%,#ffe5e5,#ff8080 55%,#ff2f2f 95%); box-shadow: 0 10px 25px -8px #000, 0 0 0 3px #7f1010 inset; color:#3b0000; }
    .mole.up { bottom:10%; }
    .flash {
        animation: flash .5s;
    }
    @keyframes flash {
        0% { box-shadow: 0 0 0 0 var(--accent); }
        70% { box-shadow: 0 0 0 18px transparent; }
        100% { box-shadow: 0 0 0 0 transparent; }
    }
    .message {
        text-align:center;
        min-height:2.2em;
        font-size: clamp(.95rem,1.8vw,1.15rem);
        color: var(--muted);
        margin-top:4px;
    }
    footer {
        margin-top: 26px;
        font-size: .8rem;
        text-align:center;
        color: var(--muted);
        opacity:.8;
    }
    footer a {
        color: var(--accent);
        text-decoration:none;
    }
    .pulse {
        animation: pulse 1.5s infinite;
    }
    @keyframes pulse {
        0%,100% { transform:scale(1); filter:brightness(1); }
        45% { transform:scale(1.08); filter:brightness(1.25); }
    }
    .difficulty {
        display:flex;
        gap:8px;
        flex-wrap:wrap;
        align-items:center;
    }
    .difficulty label {
        background: var(--panel);
        padding:6px 14px;
        border-radius: 999px;
        display:flex;
        align-items:center;
        gap:6px;
        font-size:.8rem;
        cursor:pointer;
        box-shadow: 0 0 0 1px #22313f;
        transition:.2s;
    }
    .difficulty input {
        accent-color: var(--accent);
    }
    .difficulty label:hover {
        background:#213042;
    }
    .toast {
        position:fixed;
        left:50%;
        top:20px;
        transform: translateX(-50%) translateY(-40px);
        background: #0f1a22dd;
        padding:12px 20px;
        border-radius:14px;
        backdrop-filter: blur(6px);
        box-shadow: 0 6px 24px -10px #000;
        font-size:.9rem;
        display:flex;
        align-items:center;
        gap:10px;
        opacity:0;
        transition:.4s;
        z-index:999;
        pointer-events:none;
    }
    .toast.show {
        transform: translateX(-50%) translateY(0);
        opacity:1;
    }
    .badge {
        background: var(--gold);
        color:#503800;
        padding:2px 7px;
        font-size:.65rem;
        font-weight:700;
        border-radius: 7px;
        letter-spacing:.05em;
    }
    .progress-wrap {
        position:relative;
        background:#13202b;
        height:14px;
        border-radius:8px;
        overflow:hidden;
        box-shadow:0 0 0 1px #263744 inset;
        margin-top:4px;
    }
    .progress-bar {
        position:absolute;
        inset:0;
        width:100%;
        transform-origin:left;
        background: linear-gradient(90deg,var(--accent),#2fe88a);
        box-shadow: 0 0 0 1px #1b3c2a inset;
        transition: width .2s linear;
    }
    .combo {
        position:absolute;
        top:12px;
        right:12px;
        background: linear-gradient(135deg,#ffcf40,#ff9d00);
        color:#412e00;
        padding:6px 14px;
        border-radius:12px;
        font-weight:700;
        font-size:.85rem;
        letter-spacing:.05em;
        box-shadow:0 4px 14px -6px #000;
        opacity:0;
        transform:translateY(-8px) scale(.9);
        transition:.35s cubic-bezier(.6,1.7,.5,.9);
        pointer-events:none;
        z-index:10;
    }
    .combo.show {
        opacity:1;
        transform:translateY(0) scale(1);
    }
    @media (max-width:600px) {
        .board { --cols:3; gap:12px; }
        .hole { border-radius:16px; }
    }
</style>
</head>
<body>
<div class="game-shell" role="application" aria-label="Whack-a-mole game">
    <h1>Whack-a-Mole+</h1>
    <div class="top-bar">
        <div class="stats" aria-live="polite">
            <div class="stat" title="Current Score">
                <strong>Score</strong>
                <span class="value" id="score">0</span>
            </div>
            <div class="stat" title="Time Left">
                <strong>Time</strong>
                <span class="value" id="time">30</span>
            </div>
            <div class="stat" title="High Score (best ever)">
                <strong>Best</strong>
                <span class="value" id="highscore">0</span>
            </div>
            <div class="stat" title="Current Level">
                <strong>Lvl</strong>
                <span class="value" id="level">1</span>
            </div>
        </div>
        <div style="display:flex;flex-direction:column;gap:8px;align-items:flex-end;">
            <div class="difficulty" title="Select difficulty">
                <label><input type="radio" name="difficulty" value="easy" checked /> Easy</label>
                <label><input type="radio" name="difficulty" value="normal" /> Normal</label>
                <label><input type="radio" name="difficulty" value="hard" /> Hard</label>
                <label><input type="radio" name="difficulty" value="insane" /> Insane</label>
            </div>
            <div style="display:flex;gap:10px;align-items:center;">
                <button id="startBtn" class="pulse" aria-label="Start new game">Start Game</button>
                <button id="pauseBtn" disabled aria-label="Pause or resume game">Pause</button>
                <button id="resetBtn" disabled aria-label="Reset game progress">Reset</button>
            </div>
        </div>
    </div>
    <div class="progress-wrap" aria-hidden="true">
        <div class="progress-bar" id="progressBar"></div>
    </div>
    <div class="board" id="board" aria-label="Game board grid" role="grid"></div>
    <div class="message" id="message" aria-live="polite">
        Click Start Game or press Space. Hit green moles, avoid red! (You can also use number keys 1-9)
    </div>
    <div class="combo" id="comboBadge">x1</div>
    <footer>
        &copy; <span id="year"></span> Aniket Kumar Raj &mdash; Enjoy the game! |
        <a href="#" id="howToLink">How to Play</a>
    </footer>
</div>

<div class="toast" id="toast">
    <span id="toastText"></span>
    <span class="badge" id="toastBadge"></span>
</div>

<script>
(function(){
    const boardEl = document.getElementById('board');
    const scoreEl = document.getElementById('score');
    const timeEl = document.getElementById('time');
    const highScoreEl = document.getElementById('highscore');
    const startBtn = document.getElementById('startBtn');
    const pauseBtn = document.getElementById('pauseBtn');
    const resetBtn = document.getElementById('resetBtn');
    const messageEl = document.getElementById('message');
    const progressBar = document.getElementById('progressBar');
    const comboBadge = document.getElementById('comboBadge');
    const toastEl = document.getElementById('toast');
    const toastText = document.getElementById('toastText');
    const toastBadge = document.getElementById('toastBadge');
    const yearEl = document.getElementById('year');
    yearEl.textContent = new Date().getFullYear();

    const DIFFS = {
        easy:   { spawnMin:700, spawnMax:1100, moleUp:1000, badChance:0.15, time:40, comboWindow:1100 },
        normal: { spawnMin:520, spawnMax:900,  moleUp:850,  badChance:0.22, time:35, comboWindow:950 },
        hard:   { spawnMin:380, spawnMax:760,  moleUp:720,  badChance:0.30, time:32, comboWindow:800 },
        insane: { spawnMin:260, spawnMax:580,  moleUp:620,  badChance:0.38, time:28, comboWindow:650 },
    };

    let holes = [];
    const HOLES = 9;

    function buildBoard() {
        boardEl.innerHTML = '';
        holes = [];
        for (let i=0;i<HOLES;i++){
            const hole = document.createElement('div');
            hole.className='hole';
            hole.setAttribute('role','button');
            hole.setAttribute('aria-label','Hole '+(i+1));
            hole.dataset.index=i;
            hole.addEventListener('pointerdown', ()=> whack(hole));
            boardEl.appendChild(hole);
            holes.push(hole);
        }
    }
    buildBoard();

    let currentDiff = 'easy';
    let gameState = 'idle'; // idle, running, paused, ended
    let score=0;
    let highScore = +localStorage.getItem('whack_best')||0;
    let timeLeft = DIFFS[currentDiff].time;
    let spawnTimer = null;
    let countdownTimer = null;
    let level = 1;
    let lastHole = null;
    let combo = 0;
    let lastHitTime = 0;

    highScoreEl.textContent = highScore;

    function rand(min,max){ return Math.random()*(max-min)+min; }

    function chooseHole(){
        let hole;
        do {
            hole = holes[Math.floor(Math.random()*holes.length)];
        } while (hole === lastHole);
        lastHole = hole;
        return hole;
    }

    function spawnMole() {
        if (gameState!=='running') return;
        const diff = DIFFS[currentDiff];
        const hole = chooseHole();
        if (hole.querySelector('.mole')) {
            // already occupied; schedule next
            scheduleNextSpawn();
            return;
        }
        const mole = document.createElement('div');
        const isBad = Math.random()< diff.badChance;
        mole.className = 'mole '+ (isBad?'bad':'good');
        mole.textContent = isBad?'✖':'★';
        hole.appendChild(mole);
        requestAnimationFrame(()=> mole.classList.add('up'));

        // Auto retract
        const upTime = diff.moleUp * (0.92 + Math.random()*0.24) * (1 - (level-1)*0.03);
        const retractTimer = setTimeout(()=>{
            mole.classList.remove('up');
            setTimeout(()=> mole.remove(), 280);
        }, upTime);

        mole.addEventListener('pointerdown', e=>{
            e.stopPropagation();
            whack(hole);
        }, { once:true });

        scheduleNextSpawn();
    }

    function scheduleNextSpawn(){
        if (gameState!=='running') return;
        const diff = DIFFS[currentDiff];
        const delay = rand(diff.spawnMin, diff.spawnMax) * (1 - (level-1)*0.04);
        spawnTimer = setTimeout(spawnMole, delay);
    }

    function startGame(){
        if (gameState === 'running') return;
        buildBoard(); // fresh board
        holes.forEach(h=> h.addEventListener('pointerdown', ()=> whack(h)));
        const diff = DIFFS[currentDiff];
        score=0;
        level=1;
        combo=0;
        lastHitTime=0;
        updateScore(0);
        timeLeft = diff.time;
        updateTime();
        gameState='running';
        startBtn.disabled=true;
        pauseBtn.disabled=false;
        resetBtn.disabled=false;
        startBtn.classList.remove('pulse');
        messageEl.textContent = 'Game on! Hit green stars, avoid red crosses!';
        runCountdown();
        spawnMole();
        animateProgress();
    }

    function pauseGame(){
        if (gameState!=='running') return;
        gameState='paused';
        clearTimeout(spawnTimer);
        clearInterval(countdownTimer);
        pauseBtn.textContent='Resume';
        messageEl.textContent='Paused. Press Resume or Space.';
    }

    function resumeGame(){
        if (gameState!=='paused') return;
        gameState='running';
        pauseBtn.textContent='Pause';
        messageEl.textContent='Go go go!';
        runCountdown();
        scheduleNextSpawn();
        animateProgress();
    }

    function endGame(){
        if (gameState==='ended' || gameState==='idle') return;
        gameState='ended';
        clearTimeout(spawnTimer);
        clearInterval(countdownTimer);
        messageEl.textContent = 'Time! Final Score: '+score+' — '+ rankTitle(score) +'. Press Start to play again.';
        startBtn.disabled=false;
        pauseBtn.disabled=true;
        resetBtn.disabled=false;
        pauseBtn.textContent='Pause';
        // remove all moles
        holes.forEach(h=>{
            const m = h.querySelector('.mole');
            if (m){
                m.classList.remove('up');
                setTimeout(()=> m.remove(), 250);
            }
        });
        if (score>highScore){
            highScore=score;
            highScoreEl.textContent=highScore;
            localStorage.setItem('whack_best', highScore);
            showToast('New High Score!', '🏆');
        }
    }

    function resetGame(){
        clearTimeout(spawnTimer);
        clearInterval(countdownTimer);
        progressBar.style.width='100%';
        holes.forEach(h=> h.innerHTML='');
        gameState='idle';
        score=0;
        level=1;
        combo=0;
        updateScore(0);
        timeLeft=DIFFS[currentDiff].time;
        updateTime();
        startBtn.disabled=false;
        pauseBtn.disabled=true;
        resetBtn.disabled=true;
        pauseBtn.textContent='Pause';
        messageEl.textContent='Reset complete. Choose difficulty & Start!';
    }

    function runCountdown(){
        clearInterval(countdownTimer);
        countdownTimer = setInterval(()=>{
            if (gameState!=='running') return;
            timeLeft -= 1;
            updateTime();
            if (timeLeft<=0){
                timeLeft=0;
                updateTime();
                endGame();
            }
        },1000);
    }

    function updateTime(){
        timeEl.textContent = timeLeft;
    }

    function updateScore(delta){
        score += delta;
        if (score<0) score=0;
        scoreEl.textContent = score;
        // level progression
        const newLevel = Math.min(10, Math.floor(score/25)+1);
        if (newLevel!==level){
            level = newLevel;
            document.getElementById('level').textContent = level;
            showToast('Level Up! → '+level,'⚡');
        }
    }

    function animateProgress(){
        if (gameState!=='running') return;
        const total = DIFFS[currentDiff].time;
        const pct = Math.max(0, timeLeft/total)*100;
        progressBar.style.width = pct+'%';
        requestAnimationFrame(()=> {
            if (gameState==='running') requestAnimationFrame(animateProgress);
        });
    }

    function whack(hole){
        if (gameState!=='running') return;
        const mole = hole.querySelector('.mole.up');
        if (!mole) {
            // miss penalty small
            updateScore(-1);
            combo=0;
            updateComboBadge();
            flashHole(hole,'miss');
            return;
        }
        const isBad = mole.classList.contains('bad');
        const now = performance.now();
        const diff = DIFFS[currentDiff];
        if (!isBad){
            // combo logic
            if (lastHitTime && (now - lastHitTime) <= diff.comboWindow){
                combo++;
            } else {
                combo=1;
            }
            lastHitTime = now;
            const base=5;
            const gain = base + Math.floor((combo-1)*1.5);
            updateScore(gain);
            flashHole(hole,'good');
            mole.textContent='✔';
            showCombo();
        } else {
            // penalty
            updateScore(-7);
            combo=0;
            updateComboBadge();
            flashHole(hole,'bad');
            mole.textContent='💥';
            showToast('Ouch! Bad Mole','💣');
        }
        mole.classList.remove('up');
        setTimeout(()=> mole.remove(), 180);
    }

    function showCombo(){
        if (combo<=1){
            updateComboBadge();
            return;
        }
        comboBadge.textContent = 'COMBO x'+combo;
        comboBadge.classList.add('show');
        updateComboBadge();
        clearTimeout(comboBadge._t);
        comboBadge._t = setTimeout(()=>{
            comboBadge.classList.remove('show');
        }, 1200);
    }

    function updateComboBadge(){
        if (combo<=1){
            comboBadge.textContent='x1';
        }
    }

    function flashHole(hole,type){
        hole.classList.remove('flash-good','flash-bad','flash-miss');
        const colorMap = {
            good:'0 0 0 4px #24d26f66 inset,0 0 12px -2px #24d26f',
            bad:'0 0 0 4px #ff2f2f66 inset,0 0 12px -2px #ff2f2f',
            miss:'0 0 0 4px #ffffff22 inset,0 0 10px -2px #ffffff33'
        };
        const original = hole.style.boxShadow;
        hole.style.boxShadow = colorMap[type] || original;
        setTimeout(()=> hole.style.boxShadow='', 240);
    }

    function rankTitle(score){
        if (score>=250) return 'Legend';
        if (score>=200) return 'Master';
        if (score>=150) return 'Expert';
        if (score>=100) return 'Skilled';
        if (score>=60)  return 'Apprentice';
        if (score>=30)  return 'Novice';
        return 'Beginner';
    }

    function showToast(text, badge){
        toastText.textContent=text;
        toastBadge.textContent=badge||'';
        toastEl.classList.add('show');
        clearTimeout(toastEl._t);
        toastEl._t = setTimeout(()=> toastEl.classList.remove('show'), 2200);
    }

    // Difficulty selection
    document.querySelectorAll('input[name="difficulty"]').forEach(r=>{
        r.addEventListener('change', e=>{
            currentDiff = e.target.value;
            if (gameState==='idle') {
                timeLeft = DIFFS[currentDiff].time;
                updateTime();
                messageEl.textContent = 'Difficulty set to '+currentDiff+'. Press Start!';
            } else {
                showToast('Difficulty changes next round','⚙');
            }
        });
    });

    startBtn.addEventListener('click', ()=> {
        if (gameState==='paused') {
            resumeGame();
        } else {
            startGame();
        }
    });

    pauseBtn.addEventListener('click', ()=>{
        if (gameState==='running') pauseGame();
        else if (gameState==='paused') resumeGame();
    });

    resetBtn.addEventListener('click', resetGame);

    // Keyboard controls
    window.addEventListener('keydown', e=>{
        if (e.code==='Space'){
            e.preventDefault();
            if (gameState==='idle' || gameState==='ended') startGame();
            else if (gameState==='running') pauseGame();
            else if (gameState==='paused') resumeGame();
        }
        if (/^[1-9]$/.test(e.key)){
            const index = +e.key - 1;
            whack(holes[index]);
        }
    });

    // How to play
    document.getElementById('howToLink').addEventListener('click', e=>{
        e.preventDefault();
        showToast('Hit green, avoid red! Combos = speed hits.','ℹ');
    });

})();
</script>
</body>
</html>
